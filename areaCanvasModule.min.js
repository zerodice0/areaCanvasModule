function Point(e,t){"use strict";var n=0,r=0;e&&(n=e),t&&(r=t),this.getX=function(){return n},this.getY=function(){return r},this.setX=function(e){e&&(n=e)},this.setY=function(e){e&&(r=e)},this.get=function(){return this},this.getPoint=function(){return{x:n,y:r}},this.setPoint=function(e,t){e&&(n=e),t&&(r=t)},this.toString=function(){return"("+n+", "+r+")"}}function AreaCanvasModule(){"use strict";function e(){var e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),t=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),n=window.navigator.userAgent,r=-1;return"Microsoft Internet Explorer"==window.navigator.appName?null!=e.exec(n)&&(r=parseFloat(RegExp.$1)):"Netscape"==window.navigator.appName&&null!=t.exec(n)&&(r=parseFloat(RegExp.$1)),r}function t(e,t){if(e<0)return!1;if(!E[e]&&E[e].length<M)for(var n=0;n<=e;n++)null==E[n]&&(E[n]=new Array);if(t&&t instanceof Point)E[e].push(t),J("new Point Object("+t.getX()+", "+t.getY()+") is add to area"+e+".");else{if(null==t.x||null==t.y)return J("param error!"),!1;E[e].push(new Point(t.x,t.y)),J("new Point Object("+t.x+", "+t.y+") is add to area"+e+".")}return r(),!0}function n(){var e=0,t=0,n=null,r=null;for(G&&(k.beginPath(),k.strokeStyle="#000000",k.moveTo(z,z),k.lineTo(z+m,z),k.lineTo(z+m,z+X),k.lineTo(z,z+X),k.lineTo(z,z),k.stroke()),e=0,n=E[e];n;n=E[++e])if(!W||$==e){for(k.beginPath(),t=0,r=n[t];r;r=n[++t])0===t?(k.moveTo(r.getX()+z,r.getY()+z),k.arc(r.getX()+z,r.getY()+z,F,0,2*Math.PI,!0),k.fillStyle=S[e],k.fill(),k.moveTo(r.getX()+z,r.getY()+z)):(k.lineTo(r.getX()+z,r.getY()+z),k.moveTo(r.getX()+z,r.getY()+z),k.arc(r.getX()+z,r.getY()+z,F,0,2*Math.PI,!0),k.fillStyle=S[e],k.fill(),k.moveTo(r.getX()+z,r.getY()+z));null!=n[0]&&(k.lineTo(n[0].getX()+z,n[0].getY()+z),k.globalAlpha=1,k.strokeStyle=S[e],k.stroke())}return!0}function r(e){var t=e||Y.src;if(k.clearRect(0,0,v.width,v.height),i(t),1==H&&(j>=0||P>=0)){var r=P>=0?P:j;g(E[r],D)}return n(),!0}function i(e){var t=B;e&&(t=e),Y=new Image(m,X),Y.onload=function(){var e=null==U?m:U(m),n=null==q?X:q(X),r=z+(m-e)/2,i=z+(X-n)/2;v.style.background="url("+t+")",v.style.backgroundPosition=r+"px "+i+"px",v.style.backgroundSize=e+"px "+n+"px",v.style.backgroundRepeat="no-repeat"},Y.src=t}function o(e,t,n){var r=!1;if(!e instanceof Point)return r;if(!t instanceof Point)return r;if(!n instanceof Point)return r;var i=e,o=t,l=Math.min(i.getX(),o.getX()),a=Math.max(i.getX(),o.getX()),u=Math.min(i.getY(),o.getY()),g=Math.max(i.getY(),o.getY()),s=(o.getY()-i.getY())/(o.getX()-i.getX());return i.getY()==o.getY()&&i.getY()-F<n.getY()&&n.getY()<i.getY()+F&&l<n.getX()&&n.getX()<a?r=!0:i.getX()==o.getX()&&i.getX()-F<n.getX()&&n.getX()<i.getX()+F&&u<n.getY()&&n.getY()<g?r=!0:n.getY()-i.getY()-3<=s*(n.getX()-i.getX())&&s*(n.getX()-i.getX())<=n.getY()-i.getY()+3&&l<n.getX()&&n.getX()<a&&(r=!0),r}function l(){w=-1,b=-1,x=-1,T=-1}function a(e){var t=E[e];if(!t)return!1;for(var n=0,r=t[n];r;r=t[++n])(-1==b||b>r.getX())&&(b=r.getX()),(-1==w||w>r.getY())&&(w=r.getY()),(-1==x||x<r.getX())&&(x=r.getX()),(-1==T||T<r.getY())&&(T=r.getY());return!0}function u(e,t,n){var r=null;if(k.beginPath(),null!=n){for(var i=0,o=n[i];o;o=n[++i])0==i?k.moveTo(o.getX()+z,o.getY()+z):k.lineTo(o.getX()+z,o.getY()+z);k.closePath(),r=k.isPointInPath(e,t)}return r}function g(e,t){k.beginPath();for(var n=0,r=e[n];r;r=e[++n])0==n?k.moveTo(r.getX()+z,r.getY()+z):k.lineTo(r.getX()+z,r.getY()+z);return k.closePath(),k.fillStyle=t,k.globalAlpha=L,k.fill()}function s(e){for(var t=[],n=0,r=e[n];r;r=e[++n])t.push(new Point(r.getX(),r.getY()));return t}function f(e){var t=v.getBoundingClientRect(),n=E[$],i=e.clientX-t.left,o=e.clientY-t.top;if(J("click point: ("+i+", "+o+")"),null!=n){k.beginPath();for(var u=0,g=n[u];g;g=n[++u])if(0==u?k.moveTo(g.getX(),g.getY()):k.lineTo(g.getX(),g.getY()),g.getX()+z-F<i&&i<g.getX()+z+F&&g.getY()+z-F<o&&o<g.getY()+z+F){0==e.button?(P=$,C=u):!N&&2==e.button&&n.length>3&&(e.preventDefault(),n.splice(u,1),r());break}k.closePath(),k.isPointInPath(i,o)&&P<0&&C<0&&(P=$,A=i,y=o,I=s(E[P]),l(),a(P))}}function c(e){var t=v.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;J("click point: ("+n+", "+i+")");for(var o=0,u=E[o];u;u=E[++o]){k.beginPath();for(var g=0,f=u[g];f;f=u[++g])if(0==g?k.moveTo(f.getX(),f.getY()):k.lineTo(f.getX(),f.getY()),f.getX()+z-F<n&&n<f.getX()+z+F&&f.getY()+z-F<i&&i<f.getY()+z+F){0==e.button?(P=o,C=g):!N&&2==e.button&&u.length>3&&(e.preventDefault(),u.splice(g,1),r());break}k.closePath(),k.isPointInPath(n,i)&&P<0&&C<0&&(P=o,A=n,y=i,I=s(E[P]),l(),a(P))}}var h=null,d=null,v=null,p=e(),m=640,X=480,Y=null,P=-1,A=-1,y=-1,w=-1,b=-1,x=-1,T=-1,C=-1,I=null,k=null,E=[],R=!1,F=3,M=16,O=4,B=null,S=["#EC7063","#AF7AC5","#5DADE2","#7DCEA0","#F4D03F","#EB984E"],N=!1,D="#CCAF0A",j=-1,L=.5,H=!0,W=!1,$=0,z=0,U=null,q=null,G=!1,J=function(e){console&&console.log&&R&&console.log(e)};this.init=function(e){return null!=e.width&&(m=e.width),null!=e.height&&(X=e.height),null!=e.debug&&(R=e.debug),null!=e.id&&(d=e.id),null!=e.pointNumberLimit&&(M=e.pointNumberLimit),null!=e.areaNumberLimit&&(O=e.areaNumberLimit),null!=e.defaultImage&&(B=e.defaultImage),null!=e.hoveredAreaColor&&(D=e.hoveredAreaColor),null!=e.hoveredAreaAlpha&&(L=e.hoveredAreaAlpha),null!=e.hoveredAreaHighlight&&(H=e.hoveredAreaHighlight),null!=e.modifyOnlyOneArea&&(W=e.modifyOnlyOneArea),null!=e.canvasPadding&&(z=e.canvasPadding),null!=e.imageCropWidthFunc&&(U=e.imageCropWidthFunc),null!=e.imageCropHeightFunc&&(q=e.imageCropHeightFunc),null!=e.drawBorder&&(G=e.drawBorder),null!=e.arrayColor&&(S=function(e,t){var n=e,r=n.length,i=S.length;if(n.length<t)for(r=n.length;r<t&&r<i;r++)n.push(e[r]);return n}(e.arrayColor,O)),null!=e.isFixPointNumber&&(N=e.isFixPointNumber),h=document.getElementById(d),h?(h.innerHTML=0<p&&p<10?"<span>not support Internet Explorer "+p+". Please using Chrome Browser.</span>":'<canvas width="'+(m+2*z)+'" height="'+(X+2*z)+'"></canvas>',v=h.children[0],v?(k=v.getContext("2d"),i(B),v.onmousedown||(v.onmousedown=W?f:c),v.oncontextmenu||(v.oncontextmenu=function(e){e.preventDefault()}),v.onmousemove||(v.onmousemove=function(e){var t=v.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,o=0,l=0,g=null,s=0,f=0,c=0,h=0,d=!1;if(W)u(n-A,i-y,E[$])&&(j=$,d=!0);else for(f=0;f<E.length;f++)u(n-A,i-y,E[f])&&(j=f,d=!0);if(g=E[P],g){if(P>=0&&C>=0)g[C].setPoint(n-z,i-z),r();else if(P>=0&&A>=0&&y>=0){for(s=g.length,c=n-A,h=i-y,a(P),f=0;f<s;f++)o=g[f].getX()+c,l=g[f].getY()+h,g[f].setPoint(o,l);a(P),A=n,y=i,r()}}else j>=0&&0==d?(j=-1,r()):d&&r()}),v.onmouseup||(v.onmouseup=function(e){var t=v.getBoundingClientRect();e.clientX,t.left,e.clientY,t.top;if(C>=0){var n=E[P][C];w<z&&n.setY(0),T>X+z&&n.setY(X),b<z&&n.setX(0),x>m+z&&n.setX(m)}else P>=0&&(a(P),(b<0||w<0||x>m||T>X)&&null!=I&&(E[P]=s(I)));r(),P=-1,A=-1,y=-1,l(),C=-1,I=null}),void(v.ondblclick||(v.ondblclick=function(e){if(N)return!1;var t=0,n=0,i=null,l=null,a=null,u=E.length,g=0,s=v.getBoundingClientRect(),f=e.clientX-s.left,c=e.clientY-s.top,h=new Point(f,c);for(t=0;t<u;t++)if(i=E[t],g=i.length,g<M){for(n=1;n<g;n++)if(l=i[n-1],a=i[n],o(l,a,h)){i.splice(n,0,h);break}l=i[n-1],a=i[0],o(l,a,h)&&i.splice(n,0,h)}r()}))):(J("Can not create Canavas Element."),!1)):(J("paramElemId is not found."),!1)},this.checkAllPointIsSame=function(e,t,n){var r=!0,i=null!=e?e:0,o=E[i],l=null!=t?t:0,a=null!=n?n:0;if(null!=o)for(var u=0,g=o[0];u<o.length;g=o[++u])l==g.getX()&&a==g.getY()||(r=!1);return r},this.getAllArea=function(){return E},this.getArea=function(e){return!(e<0)&&(!!E[e]&&E[e])},this.removeAllArea=function(){E.length=0,r()},this.removeArea=function(e){return!(e<0)&&(!!E[e]&&(E[e].length=0,void r()))},this.getAreaToRelativeCoordinates=function(e){if(e<0)return!1;if(!E[e])return!1;for(var t=[],n=null,r=0;r<E[e].length;r++)n=E[e][r],t.push(new Point(n.getX()/m,n.getY()/X));return t},this.addPointToArea=function(e,n){return t(e,n)},this.addPointArrayToArea=function(e,t){if(e<0)return!1;if(e>O)return!1;if(!E[e])for(var n=0;n<=e;n++)null==E[n]&&(E[n]=new Array);for(var i in t)if(null!=t[i]&&t[i]instanceof Point)E[e].push(t[i]),J("new Point Object("+t[i].getX()+", "+t[i].getY()+") is add to area"+e+".");else{if(null==t[i].x||null==t[i].y)return J("param error!"),!1;E[e].push(new Point(t[i].x,t[i].y)),J("new Point Object("+t[i].x+", "+t[i].y+") is add to area"+e+".")}return r(),!0},this.addPushArrayToArea=function(e){var t=E.length;if(t>=O)return!1;for(var n in E[t]||(E[t]=[]),e)if(null!=e[n]&&e[n]instanceof Point)E[t].push(e[n]),J("new Point Object("+e[n].getX()+", "+e[n].getY()+") is add to area"+t+".");else{if(null==e[n].x||null==e[n].y)return J("param error!"),!1;E[t].push(new Point(e[n].x,e[n].y)),J("new Point Object("+e[n].x+", "+e[n].y+") is add to area"+t+".")}return r(),!0},this.setPointArrayToArea=function(e,t){if(e<0)return J("paramAreaIndex is wrong!"),!1;if(null==t||0==t.length)return J("paramPointArray is empty or null!"),!1;for(var n=[],i=0,o=t[i];o;o=t[++i])n.push(new Point(o.x,o.y));return E[e]=s(n),r(),!0},this.deletePointFromArea=function(e,t){return e<0?(J("paramAreaIndex is wrong!"),!1):t<0?(J("paramPointIndex is wrong!"),!1):null==E[e]?(J("arrayArea["+e+"] is undefined!"),!1):null==E[e][t]?(J("arrayArea["+e+"]["+t+"] is undefined!"),!1):E[e].length<4?(J("arrayArea["+e+"] has 3 points!"),!1):(E[e].splice(t,1),r(),!0)},this.setImageURL=function(e){return i(e),!0},this.refreshCanvas=function(e){return r(e),!0},this.drawRect=function(e,t,n,r,i){var o=0,l=0,a=0,u=0,g=0,s=0;return null!=e&&null!=t&&null!=n&&null!=r&&(i&&i,e&&(o=e),t&&(l=t),n&&(a=n),r&&(u=r),g=a-o,s=u-l,k.beginPath(),k.strokeStyle="#8561c7",k.rect(o,l,g,s),k.stroke(),!0)},this.isModifyOnlyOneArea=function(){return W},this.changeModifyAreaIndex=function(e){return $=e<0||e>=E.length?-1:e,r(),!0}}