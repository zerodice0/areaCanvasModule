function Point(t,e){"use strict";var n=0,o=0;t&&(n=t),e&&(o=e),this.getX=function(){return n},this.getY=function(){return o},this.setX=function(t){t&&(n=t)},this.setY=function(t){t&&(o=t)},this.get=function(){return this},this.getPoint=function(){return{x:n,y:o}},this.setPoint=function(t,e){t&&(n=t),e&&(o=e)}}function AreaCanvasModule(){"use strict";function t(){var t=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),n=window.navigator.userAgent,o=-1;return"Microsoft Internet Explorer"==window.navigator.appName?null!=t.exec(n)&&(o=parseFloat(RegExp.$1)):"Netscape"==window.navigator.appName&&null!=e.exec(n)&&(o=parseFloat(RegExp.$1)),o}function e(t,e){if(t<0)return!1;if(!A[t])for(var n=0;n<=t;n++)null==A[n]&&(A[n]=new Array);if(e&&e instanceof Point)A[t].push(e),I("new Point Object("+e.getX()+", "+e.getY()+") is add to area"+t+".");else{if(null==e.x||null==e.y)return I("param error!"),!1;A[t].push(new Point(e.x,e.y)),I("new Point Object("+e.x+", "+e.y+") is add to area"+t+".")}return o(),!0}function n(){var t=0,e=0,n=null,o=null,i=A.length,r=0;for(t=0;t<i;t++){for(n=A[t],r=n.length,y.beginPath(),e=0;e<r;e++)o=n[e],0===e?(y.moveTo(o.getX(),o.getY()),y.arc(o.getX(),o.getY(),E,0,2*Math.PI,!0),y.fillStyle=C[t],y.fill(),y.moveTo(o.getX(),o.getY())):(y.lineTo(o.getX(),o.getY()),y.moveTo(o.getX(),o.getY()),y.arc(o.getX(),o.getY(),E,0,2*Math.PI,!0),y.fillStyle=C[t],y.fill(),y.moveTo(o.getX(),o.getY()));y.lineTo(n[0].getX(),n[0].getY()),y.strokeStyle=C[t],y.stroke()}return!0}function o(t){var e=null;return y.clearRect(0,0,s.width,s.height),e=t||d.src,i(e),n(),!0}function i(t){var e="/images/imgfail.jpg";t&&(e=t),d=new Image(f,h),d.onload=function(){s.style.background="url("+e+")",s.style.backgroundSize="100% 100%"},d.src=e}function r(t,e,n){if(!t instanceof Point)return!1;if(!e instanceof Point)return!1;if(!n instanceof Point)return!1;var o=t,i=e,r=Math.min(o.getX(),i.getX()),g=Math.max(o.getX(),i.getX()),a=Math.min(o.getY(),i.getY()),l=Math.max(o.getY(),i.getY()),u=(i.getY()-o.getY())/(i.getX()-o.getX());return o.getY()==i.getY()&&o.getY()-E<n.getY()&&n.getY()<o.getY()+E&&r<n.getX()&&n.getX()<g||(o.getX()==i.getX()&&o.getX()-E<n.getX()&&n.getX()<o.getX()+E&&a<n.getY()&&n.getY()<l||n.getY()-o.getY()-3<=u*(n.getX()-o.getX())&&u*(n.getX()-o.getX())<=n.getY()-o.getY()+3&&r<n.getX()&&n.getX()<g)}function g(){v=-1,m=-1,P=-1,w=-1}function a(t){var e=A[t];if(!e)return!1;for(var n=0,o=e[n];o;o=e[++n])(-1==m||m>o.getX())&&(m=o.getX()),(-1==v||v>o.getY())&&(v=o.getY()),(-1==P||P<o.getX())&&(P=o.getX()),(-1==w||w<o.getY())&&(w=o.getY());return!0}var l=null,u=null,s=null,c=t(),f=640,h=480,d=null,X=-1,Y=-1,p=-1,v=-1,m=-1,P=-1,w=-1,x=-1,y=null,A=[],b=!1,E=3,C=["#EC7063","#AF7AC5","#5DADE2","#7DCEA0","#F4D03F","#EB984E"],I=function(t){console&&console.log&&b&&console.log(t)};this.init=function(t){return f=t.width?t.width:640,h=t.height?t.height:480,b=!!t.debug&&t.debug,u=t.id?t.id:"frcanvas",l=document.getElementById(u),l?(l.innerHTML=0<c&&c<10?"<span>not support Internet Explorer "+c+". Please using Chrome Browser.</span>":'<canvas width="'+f+'" height="'+h+'"></canvas>',s=l.children[0],s?(y=s.getContext("2d"),s.onmousedown||(s.onmousedown=function(t){var e=s.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;I("click point: ("+n+", "+i+")");for(var r=0,l=A[r];l;l=A[++r]){y.beginPath();for(var u=0,c=l[u];c;c=l[++u])if(0==u?y.moveTo(c.getX(),c.getY()):y.lineTo(c.getX(),c.getY()),c.getX()-E<n&&n<c.getX()+E&&c.getY()-E<i&&i<c.getY()+E){0==t.button?(X=r,x=u):2==t.button&&l.length>3&&(t.preventDefault(),l.splice(u,1),o());break}y.closePath(),y.isPointInPath(n,i)&&X<0&&x<0&&(X=r,Y=n,p=i,g(),a(X))}}),s.oncontextmenu||(s.oncontextmenu=function(t){t.preventDefault()}),s.onmousemove||(s.onmousemove=function(t){var e=s.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=0,l=0,u=null,c=0,f=0,h=0,d=0,y=!1;if(u=A[X],u)if(X>=0&&x>=0)u[x].setPoint(n,i),o();else if(X>=0&&Y>=0&&p>=0){for(c=u.length,h=n-Y,d=i-p,a(X),console.log(h+" "+d),console.log(m+" "+v+" "+P+" "+w),h<0&&m<=0&&(h=1,y=!0),h>0&&P>=s.width&&(h=-1,y=!0),d<0&&v<=0&&(d=1,y=!0),d>0&&w>=s.height&&(d=-1,y=!0),f=0;f<c;f++)r=u[f].getX()+h,l=u[f].getY()+d,u[f].setPoint(r,l);a(X),Y=n,p=i,o(),y&&(X=-1,Y=-1,p=-1,g(),x=-1)}}),s.onmouseup||(s.onmouseup=function(t){X=-1,Y=-1,p=-1,g(),x=-1}),void(s.ondblclick||(s.ondblclick=function(t){var e=0,n=0,i=null,g=null,a=null,l=A.length,u=0,c=s.getBoundingClientRect(),f=t.clientX-c.left,h=t.clientY-c.top,d=new Point(f,h);for(e=0;e<l;e++){i=A[e],u=i.length;for(n=1;n<u;n++)if(g=i[n-1],a=i[n],r(g,a,d)){i.splice(n,0,d);break}g=i[n-1],a=i[0],r(g,a,d)&&i.splice(n,0,d)}o()}))):(I("Can not create Canavas Element."),!1)):(I("paramElemId is not found."),!1)},this.getAllArea=function(){return A},this.getArea=function(t){return!(t<0)&&(!!A[t]&&A[t])},this.addPointToArea=function(t,n){return e(t,n)},this.addPointArrayToArea=function(t,e){if(t<0)return!1;if(!A[t])for(var n=0;n<=t;n++)null==A[n]&&(A[n]=new Array);for(var i in e)if(null!=e[i]&&e[i]instanceof Point)A[t].push(e[i]),I("new Point Object("+e[i].getX()+", "+e[i].getY()+") is add to area"+t+".");else{if(null==e[i].x||null==e[i].y)return I("param error!"),!1;A[t].push(new Point(e[i].x,e[i].y)),I("new Point Object("+e[i].x+", "+e[i].y+") is add to area"+t+".")}return o(),!0},this.deletePointFromArea=function(t,e){return t<0?(I("paramAreaIndex is wrong!"),!1):e<0?(I("paramPointIndex is wrong!"),!1):null==A[t]?(I("arrayArea["+t+"] is undefined!"),!1):null==A[t][e]?(I("arrayArea["+t+"]["+e+"] is undefined!"),!1):A[t].length<4?(I("arrayArea["+t+"] has 3 points!"),!1):(A[t].splice(e,1),o(),!0)},this.setImageURL=function(t){i(t)},this.refleshCanvas=function(){o()}}